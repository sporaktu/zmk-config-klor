# Codebase Structure

**Analysis Date:** 2025-01-14

## Directory Layout

```
zmk-config-klor/
├── .github/
│   └── workflows/
│       └── build.yml              # GitHub Actions CI workflow
├── .planning/
│   └── codebase/                  # Codebase analysis documents
├── config/                        # Main ZMK configuration
│   ├── boards/shields/klor/       # Shield definition
│   │   ├── boards/               # Controller overlays
│   │   │   ├── nice_nano_v2.overlay
│   │   │   ├── nrfmicro_11.overlay
│   │   │   └── ...
│   │   ├── icons/                # OLED bitmap assets
│   │   │   ├── bat_*.c           # Battery icons
│   │   │   ├── bt_*.c            # Bluetooth icons
│   │   │   └── ...
│   │   ├── klor.dtsi             # Main device tree
│   │   ├── klor_common.dtsi      # Shared hardware config
│   │   ├── klor_left.overlay     # Left half pins
│   │   ├── klor_right.overlay    # Right half pins
│   │   ├── klor.conf             # Shield feature config
│   │   ├── klor.zmk.yml          # Shield metadata
│   │   ├── Kconfig.shield        # Shield Kconfig flags
│   │   ├── Kconfig.defconfig     # Default config
│   │   ├── *_status.c/h          # OLED display code
│   │   └── klor_status_screen.c  # Main OLED screen
│   ├── klor.keymap               # PRIMARY: Main keymap
│   ├── klor.conf                 # Global feature config
│   ├── klor.json                 # Keymap visualization
│   ├── west.yml                  # ZMK dependency manifest
│   └── [test/backup keymaps]
├── docs/images/                  # Logo and layout SVGs
├── qmk_keymap/                   # Legacy QMK (unused)
├── build.yaml                    # Build matrix
├── CLAUDE.md                     # Project documentation
└── readme.md                     # User documentation
```

## Directory Purposes

**config/**
- Purpose: All ZMK firmware configuration files
- Contains: Keymap, feature configs, West manifest
- Key files: `klor.keymap`, `klor.conf`, `west.yml`

**config/boards/shields/klor/**
- Purpose: KLOR shield hardware definition
- Contains: Device tree, overlays, OLED code, icons
- Key files: `klor.dtsi`, `klor_left.overlay`, `klor_right.overlay`
- Subdirectories:
  - `boards/` - Controller-specific overlays
  - `icons/` - OLED bitmap assets (21 icon files)

**.github/workflows/**
- Purpose: CI/CD automation
- Contains: GitHub Actions workflow definitions
- Key files: `build.yml`

**docs/images/**
- Purpose: Documentation assets
- Contains: KLOR logo SVGs, layout diagrams

**qmk_keymap/**
- Purpose: Legacy QMK firmware (not used)
- Contains: Old QMK keymap, config, rules
- Status: Dead code, should be removed

## Key File Locations

**Entry Points:**
- `config/klor.keymap` - Main keymap definition (15 layers)
- `build.yaml` - Build target definitions

**Configuration:**
- `config/west.yml` - ZMK version pinning (v0.3.0)
- `config/klor.conf` - Global features (power, BT, NFC)
- `config/boards/shields/klor/klor.conf` - Encoder config

**Hardware:**
- `config/boards/shields/klor/klor.dtsi` - Matrix, encoders
- `config/boards/shields/klor/klor_left.overlay` - Left GPIO
- `config/boards/shields/klor/klor_right.overlay` - Right GPIO

**Documentation:**
- `CLAUDE.md` - Technical project documentation
- `readme.md` - User-facing usage guide

## Naming Conventions

**Files:**
- `klor_*.overlay` - Half-specific hardware (klor_left, klor_right)
- `klor_*.conf` - Feature configuration
- `*.dtsi` - Device tree includes
- `*_status.c/h` - OLED display modules

**Directories:**
- kebab-case: All directories
- Plural for collections: `boards/`, `icons/`

**Special Patterns:**
- `klor.zmk.yml` - Shield metadata (ZMK convention)
- `Kconfig.*` - Kconfig definitions
- `*.keymap` - ZMK keymap files

## Where to Add New Code

**New Layer:**
- Edit: `config/klor.keymap`
- Add layer define at top, layer block at bottom
- Update combos/behaviors if needed

**New Hardware Feature:**
- Device tree: `config/boards/shields/klor/klor.dtsi`
- Feature flag: `config/klor.conf`
- Controller-specific: `config/boards/shields/klor/boards/*.overlay`

**New Controller Support:**
- Add overlay: `config/boards/shields/klor/boards/{controller}.overlay`
- Add to build matrix: `build.yaml`

**New OLED Widget:**
- Implementation: `config/boards/shields/klor/{name}_status.c/h`
- Icons: `config/boards/shields/klor/icons/{icon}.c`
- Register: `config/boards/shields/klor/klor_status_screen.c`

## Special Directories

**.planning/codebase/**
- Purpose: Codebase analysis documentation
- Source: Generated by GSD tooling
- Committed: Yes

**qmk_keymap/**
- Purpose: Legacy QMK configuration (unused)
- Status: Should be removed
- Committed: Partially (untracked files exist)

**docs/images/**
- Purpose: README and documentation images
- Source: KLOR project assets
- Committed: Yes

---

*Structure analysis: 2025-01-14*
*Update when directory structure changes*
